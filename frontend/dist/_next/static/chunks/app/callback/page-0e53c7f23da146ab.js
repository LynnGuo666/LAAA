(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[258],{5601:function(e,t,r){Promise.resolve().then(r.bind(r,8295))},8295:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CallbackPage}});var s=r(7437),n=r(2265),i=r(4033),c=r(1490);function CallbackContent(){let e=(0,i.useSearchParams)(),t=(0,i.useRouter)(),[r,a]=(0,n.useState)(null),[o,l]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{let handleCallback=async()=>{try{let r=e.get("code"),s=e.get("error"),n=e.get("error_description"),i=e.get("state");if(s){a({success:!1,error:s,error_description:n,state:i}),l(!1);return}if(!r){a({success:!1,error:"invalid_request",error_description:"No authorization code received"}),l(!1);return}if("dashboard_login"===i)try{let e="".concat(window.location.origin,"/callback"),s=await fetch("/oauth/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:r,redirect_uri:e,client_id:"893d1dae6b840dd2851e38d086f54b18"})});if(!s.ok){let e=await s.json();throw Error(e.detail||"令牌交换失败")}let n=await s.json();c.Z.set("access_token",n.access_token,{expires:1}),n.refresh_token&&c.Z.set("refresh_token",n.refresh_token,{expires:7}),t.push("/dashboard");return}catch(e){a({success:!1,error:"token_exchange_failed",error_description:e.message||"令牌交换失败"}),l(!1);return}a({success:!0,code:r,state:i})}catch(e){a({success:!1,error:"client_error",error_description:"Failed to parse callback parameters"})}l(!1)};handleCallback()},[e,t]),o)?(0,s.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"处理回调..."})]})}):(0,s.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"max-w-md w-full",children:(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full ".concat((null==r?void 0:r.success)?"bg-green-100":"bg-red-100"),children:(null==r?void 0:r.success)?(0,s.jsx)("svg",{className:"h-8 w-8 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):(0,s.jsx)("svg",{className:"h-8 w-8 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,s.jsx)("h2",{className:"mt-4 text-xl font-bold text-gray-900",children:(null==r?void 0:r.success)?"OAuth授权成功":"OAuth授权失败"})]}),(0,s.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,s.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"回调信息："}),(0,s.jsx)("div",{className:"text-sm space-y-1",children:(null==r?void 0:r.success)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"授权码:"})," ",(0,s.jsx)("code",{className:"bg-gray-200 px-1 rounded text-xs",children:r.code})]}),r.state&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"State:"})," ",r.state]}),(0,s.jsx)("div",{className:"mt-3 text-green-700 text-xs",children:"✅ 授权成功！现在可以使用这个授权码换取访问令牌。"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"错误:"})," ",(0,s.jsx)("span",{className:"text-red-600",children:r.error})]}),r.error_description&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"描述:"})," ",r.error_description]}),r.state&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"State:"})," ",r.state]})]})})]}),(null==r?void 0:r.success)&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("h4",{className:"font-medium text-gray-900 mb-2",children:"下一步："}),(0,s.jsxs)("div",{className:"text-sm text-gray-600 space-y-2",children:[(0,s.jsx)("p",{children:"使用以下信息向令牌端点发送请求："}),(0,s.jsx)("pre",{className:"bg-gray-100 p-2 rounded text-xs overflow-x-auto",children:"POST /oauth/token\nContent-Type: application/x-www-form-urlencoded\n\ngrant_type=authorization_code\ncode=".concat(r.code,"\nredirect_uri=http://localhost:8000/callback\nclient_id=YOUR_CLIENT_ID")})]})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsx)("button",{onClick:()=>window.location.href="/",className:"btn-primary",children:"返回首页"})})]})})})}function CallbackPage(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"加载中..."})]})}),children:(0,s.jsx)(CallbackContent,{})})}},622:function(e,t,r){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s=r(2265),n=Symbol.for("react.element"),i=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,a=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,r){var s,i={},l=null,d=null;for(s in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(d=t.ref),t)c.call(t,s)&&!o.hasOwnProperty(s)&&(i[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===i[s]&&(i[s]=t[s]);return{$$typeof:n,type:e,key:l,ref:d,props:i,_owner:a.current}}t.Fragment=i,t.jsx=q,t.jsxs=q},7437:function(e,t,r){"use strict";e.exports=r(622)},4033:function(e,t,r){e.exports=r(94)},1490:function(e,t,r){"use strict";/*! js-cookie v3.0.5 | MIT */function assign(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)e[s]=r[s]}return e}function init(e,t){function set(r,s,n){if("undefined"!=typeof document){"number"==typeof(n=assign({},t,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),r=encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var c in n)n[c]&&(i+="; "+c,!0!==n[c]&&(i+="="+n[c].split(";")[0]));return document.cookie=r+"="+e.write(s,r)+i}}return Object.create({set,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var r=document.cookie?document.cookie.split("; "):[],s={},n=0;n<r.length;n++){var i=r[n].split("="),c=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(s[a]=e.read(c,a),t===a)break}catch(e){}}return t?s[t]:s}},remove:function(e,t){set(e,"",assign({},t,{expires:-1}))},withAttributes:function(e){return init(this.converter,assign({},this.attributes,e))},withConverter:function(e){return init(assign({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(e)}})}r.d(t,{Z:function(){return s}});var s=init({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})}},function(e){e.O(0,[971,472,744],function(){return e(e.s=5601)}),_N_E=e.O()}]);