(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[60],{5146:function(e,t,s){Promise.resolve().then(s.bind(s,2254))},2254:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return PermissionRequestPage}});var a=s(7437),n=s(2265),r=s(4033),i=s(6454);function PermissionDeniedContent(){let e=(0,r.useRouter)(),t=(0,r.useSearchParams)(),[s,c]=(0,n.useState)(null),[l,o]=(0,n.useState)(!0),d=t.get("client_id"),u=t.get("reason");return((0,n.useEffect)(()=>{if(!d){o(!1);return}i.i.getClientInfo(d).then(c).catch(e=>{console.error("Failed to fetch client info:",e)}).finally(()=>o(!1))},[d]),l)?(0,a.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"正在加载..."})]})}):(0,a.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"max-w-md w-full",children:(0,a.jsxs)("div",{className:"card",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mx-auto h-16 w-16 flex items-center justify-center rounded-full bg-red-100",children:(0,a.jsx)("svg",{className:"h-10 w-10 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,a.jsx)("h2",{className:"mt-6 text-2xl font-bold text-gray-900",children:"访问被拒绝"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"抱歉，您没有权限使用此应用"})]}),s&&(0,a.jsx)("div",{className:"mt-6 bg-gray-50 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[s.logo_uri&&(0,a.jsx)("img",{src:s.logo_uri,alt:s.client_name,className:"h-10 w-10 rounded"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:s.client_name}),s.client_description&&(0,a.jsx)("p",{className:"text-sm text-gray-600",children:s.client_description})]})]})}),u&&(0,a.jsx)("div",{className:"mt-4 bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsxs)("p",{className:"text-sm text-red-800",children:[(0,a.jsx)("span",{className:"font-medium",children:"原因："}),u]})}),(0,a.jsx)("div",{className:"mt-6 text-sm text-gray-600 text-center",children:(0,a.jsx)("p",{children:"如需访问此应用，请联系应用管理员或系统管理员。"})}),(0,a.jsx)("div",{className:"mt-6 flex justify-center",children:(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"btn-primary",children:"返回首页"})})]})})})}function PermissionRequestPage(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"加载中..."})]})}),children:(0,a.jsx)(PermissionDeniedContent,{})})}},6454:function(e,t,s){"use strict";s.d(t,{i:function(){return c}});var a=s(4829),n=s(1490);let r="".concat(window.location.protocol,"//").concat(window.location.host),i=a.Z.create({baseURL:r,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{let t=n.Z.get("access_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),i.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)!==401||(n.Z.remove("access_token"),n.Z.remove("refresh_token"),window.location.pathname.includes("/login")||(window.location.href="/login/")),Promise.reject(e)});let c={login:async e=>{let t=new FormData;t.append("username",e.username),t.append("password",e.password),t.append("grant_type","password");let s=await a.Z.post("".concat(r,"/oauth/token"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return s.data},authorize:async e=>{let t=new FormData;Object.entries(e).forEach(e=>{let[s,a]=e;null!=a&&t.append(s,a.toString())});let s=await a.Z.post("".concat(r,"/oauth/authorize"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded"},maxRedirects:0,validateStatus:e=>e<400||e>=300&&e<400});return s},getCurrentUser:async()=>{let e=await i.get("/api/v1/users/me");return e.data},getClientInfo:async e=>{let t=await i.get("/api/v1/clients/".concat(e));return t.data},register:async e=>{let t=await i.post("/api/v1/users",e);return t.data},checkPermission:async(e,t,s)=>{let a=await i.post("/api/v1/permissions/check",{user_id:e,client_id:t,requested_scopes:s});return a.data},createPermissionRequest:async e=>{let t=await i.post("/api/v1/permissions/requests",e);return t.data},getMyPermissionRequests:async()=>{let e=await i.get("/api/v1/permissions/requests/my");return e.data},getUserPermissions:async e=>{let t=await i.get("/api/v1/permissions/user/".concat(e));return t.data},getAllUsers:async()=>{let e=await i.get("/api/v1/users");return e.data},getUserById:async e=>{let t=await i.get("/api/v1/users/".concat(e));return t.data},updateUser:async(e,t)=>{let s=await i.put("/api/v1/users/".concat(e),t);return s.data},deleteUser:async e=>{let t=await i.delete("/api/v1/users/".concat(e));return t.data},getAllClients:async()=>{let e=await i.get("/api/v1/clients");return e.data},updateClient:async(e,t)=>{let s=await i.put("/api/v1/clients/".concat(e),t);return s.data},deleteClient:async e=>{let t=await i.delete("/api/v1/clients/".concat(e));return t.data},createClient:async e=>{let t=await i.post("/api/v1/clients",e);return t.data},getUserPermissionsByAdmin:async e=>{let t=await i.get("/api/v1/admin/users/".concat(e,"/permissions"));return t.data},grantUserPermission:async(e,t,s)=>{let a=await i.post("/api/v1/admin/users/".concat(e,"/permissions/").concat(t),s);return a.data},revokeUserPermission:async(e,t)=>{let s=await i.delete("/api/v1/admin/users/".concat(e,"/permissions/").concat(t));return s.data},getPermissionGroups:async()=>{let e=await i.get("/api/v1/permissions/groups");return e.data},getPermissionGroup:async e=>{let t=await i.get("/api/v1/permissions/groups/".concat(e));return t.data},updatePermissionGroup:async(e,t)=>{let s=await i.put("/api/v1/permissions/groups/".concat(e),t);return s.data}}}},function(e){e.O(0,[745,971,472,744],function(){return e(e.s=5146)}),_N_E=e.O()}]);