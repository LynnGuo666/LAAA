(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{5227:function(e,t,a){Promise.resolve().then(a.bind(a,7355))},7355:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return LoginPage}});var s=a(7437),r=a(2265),n=a(4033),i=a(6454);function LoginPage(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)(),[a,o]=(0,r.useState)(""),[c,l]=(0,r.useState)(""),[d,u]=(0,r.useState)(!1),[p,m]=(0,r.useState)(""),[h,g]=(0,r.useState)(null),[x,v]=(0,r.useState)(null);(0,r.useEffect)(()=>{let e=t.get("response_type"),a=t.get("client_id"),s=t.get("redirect_uri");if(e&&a&&s){let r={response_type:e,client_id:a,redirect_uri:s,scope:t.get("scope")||"openid",state:t.get("state")||void 0,code_challenge:t.get("code_challenge")||void 0,code_challenge_method:t.get("code_challenge_method")||void 0,nonce:t.get("nonce")||void 0};v(r),i.i.getClientInfo(a).then(g).catch(e=>{console.error("Failed to fetch client info:",e),m("无效的客户端应用")})}},[t]);let handleSubmit=async t=>{t.preventDefault(),u(!0),m("");try{if(x){let t=new URLSearchParams({...Object.fromEntries(Object.entries(x).filter(e=>{let[t,a]=e;return void 0!==a})),username:a,password:c});e.push("/authorize?".concat(t.toString()))}else{let e="".concat(window.location.origin,"/callback"),t=new URLSearchParams({response_type:"code",client_id:"0ad8034b58e35484f23c163be2648580",redirect_uri:e,scope:"openid profile email",state:"dashboard_login"});t.append("username",a),t.append("password",c),t.append("auto_login","true"),window.location.href="/oauth/authorize?".concat(t.toString())}}catch(e){var s,r;m((null===(r=e.response)||void 0===r?void 0:null===(s=r.data)||void 0===s?void 0:s.detail)||"登录失败，请检查用户名和密码")}finally{u(!1)}};return(0,s.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-primary-100",children:(0,s.jsx)("svg",{className:"h-8 w-8 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,s.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:x?"登录以授权应用":"登录您的账户"}),x&&h&&(0,s.jsxs)("div",{className:"mt-4 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:"应用程序请求访问您的账户："}),(0,s.jsxs)("div",{className:"card max-w-sm mx-auto",children:[h.logo_uri&&(0,s.jsx)("img",{src:h.logo_uri,alt:h.client_name,className:"h-12 w-12 mx-auto mb-2 rounded"}),(0,s.jsx)("h3",{className:"font-semibold text-gray-900",children:h.client_name}),h.client_description&&(0,s.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:h.client_description}),h.client_uri&&(0,s.jsx)("a",{href:h.client_uri,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-primary-600 hover:text-primary-500 mt-1 block",children:"访问官网 →"})]})]})]}),(0,s.jsxs)("form",{className:"mt-8 space-y-6",onSubmit:handleSubmit,children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"username",className:"block text-sm font-medium text-gray-700",children:"用户名或邮箱"}),(0,s.jsx)("input",{id:"username",name:"username",type:"text",autoComplete:"username",required:!0,className:"input-field",placeholder:"输入用户名或邮箱",value:a,onChange:e=>o(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"密码"}),(0,s.jsx)("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,className:"input-field",placeholder:"输入密码",value:c,onChange:e=>l(e.target.value)})]})]}),p&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:p}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{type:"submit",disabled:d,className:"btn-primary",children:d?"登录中...":"登录"})}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["没有账户？"," ",(0,s.jsx)("a",{href:"/register".concat(x?"?".concat(t.toString()):""),className:"font-medium text-primary-600 hover:text-primary-500",children:"立即注册"})]})})]})]})})}},6454:function(e,t,a){"use strict";a.d(t,{i:function(){return o}});var s=a(4829),r=a(1490);let n="".concat(window.location.protocol,"//").concat(window.location.host),i=s.Z.create({baseURL:n,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{let t=r.Z.get("access_token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e}),i.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)!==401||(r.Z.remove("access_token"),r.Z.remove("refresh_token"),window.location.pathname.includes("/login")||(window.location.href="/login/")),Promise.reject(e)});let o={login:async e=>{let t=new FormData;t.append("username",e.username),t.append("password",e.password),t.append("grant_type","password");let a=await s.Z.post("".concat(n,"/oauth/token"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return a.data},authorize:async e=>{let t=new FormData;Object.entries(e).forEach(e=>{let[a,s]=e;null!=s&&t.append(a,s.toString())});let a=await s.Z.post("".concat(n,"/oauth/authorize"),t,{headers:{"Content-Type":"application/x-www-form-urlencoded"},maxRedirects:0,validateStatus:e=>e<400||e>=300&&e<400});return a},getCurrentUser:async()=>{let e=await i.get("/api/v1/users/me");return e.data},getClientInfo:async e=>{let t=await i.get("/api/v1/clients/".concat(e));return t.data},register:async e=>{let t=await i.post("/api/v1/users",e);return t.data},checkPermission:async(e,t,a)=>{let s=await i.post("/api/v1/permissions/check",{user_id:e,client_id:t,requested_scopes:a});return s.data},createPermissionRequest:async e=>{let t=await i.post("/api/v1/permissions/requests",e);return t.data},getMyPermissionRequests:async()=>{let e=await i.get("/api/v1/permissions/requests/my");return e.data},getUserPermissions:async e=>{let t=await i.get("/api/v1/permissions/user/".concat(e));return t.data},getAllUsers:async()=>{let e=await i.get("/api/v1/users");return e.data},getUserById:async e=>{let t=await i.get("/api/v1/users/".concat(e));return t.data},updateUser:async(e,t)=>{let a=await i.put("/api/v1/users/".concat(e),t);return a.data},deleteUser:async e=>{let t=await i.delete("/api/v1/users/".concat(e));return t.data},getAllClients:async()=>{let e=await i.get("/api/v1/clients");return e.data},updateClient:async(e,t)=>{let a=await i.put("/api/v1/clients/".concat(e),t);return a.data},deleteClient:async e=>{let t=await i.delete("/api/v1/clients/".concat(e));return t.data},createClient:async e=>{let t=await i.post("/api/v1/clients",e);return t.data},getUserPermissionsByAdmin:async e=>{let t=await i.get("/api/v1/admin/users/".concat(e,"/permissions"));return t.data},grantUserPermission:async(e,t,a)=>{let s=await i.post("/api/v1/admin/users/".concat(e,"/permissions/").concat(t),a);return s.data},revokeUserPermission:async(e,t)=>{let a=await i.delete("/api/v1/admin/users/".concat(e,"/permissions/").concat(t));return a.data},getPermissionGroups:async()=>{let e=await i.get("/api/v1/permissions/groups");return e.data},getPermissionGroup:async e=>{let t=await i.get("/api/v1/permissions/groups/".concat(e));return t.data},updatePermissionGroup:async(e,t)=>{let a=await i.put("/api/v1/permissions/groups/".concat(e),t);return a.data}}}},function(e){e.O(0,[745,971,472,744],function(){return e(e.s=5227)}),_N_E=e.O()}]);