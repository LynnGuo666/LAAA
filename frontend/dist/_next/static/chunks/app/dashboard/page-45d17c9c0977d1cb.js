(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{9539:function(e,s,a){Promise.resolve().then(a.bind(a,6086))},6086:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return DashboardPage}});var r=a(7437),t=a(2265),n=a(4033);function DashboardPage(){let e=(0,n.useRouter)(),[s,a]=(0,t.useState)(null),[l,o]=(0,t.useState)([]),[i,c]=(0,t.useState)("profile"),[d,u]=(0,t.useState)(!0),[m,x]=(0,t.useState)(!1),[p,f]=(0,t.useState)({full_name:"",given_name:"",family_name:"",nickname:"",profile:"",picture:"",website:"",phone_number:"",gender:"",birthdate:"",zoneinfo:"",locale:""}),[h,b]=(0,t.useState)({current_password:"",new_password:"",confirm_password:""});(0,t.useEffect)(()=>{loadProfile(),loadLoginLogs()},[]);let loadProfile=async()=>{try{var s;let r=await fetch("/api/v1/users/me",{headers:{Authorization:"Bearer ".concat(null===(s=document.cookie.match(/access_token=([^;]+)/))||void 0===s?void 0:s[1])}});if(r.ok){let e=await r.json();a(e),f({full_name:e.full_name||"",given_name:e.given_name||"",family_name:e.family_name||"",nickname:e.nickname||"",profile:e.profile||"",picture:e.picture||"",website:e.website||"",phone_number:e.phone_number||"",gender:e.gender||"",birthdate:e.birthdate||"",zoneinfo:e.zoneinfo||"",locale:e.locale||""})}else 401===r.status&&e.push("/login")}catch(e){console.error("Failed to load profile:",e)}finally{u(!1)}},loadLoginLogs=async()=>{try{var e;let s=await fetch("/api/v1/dashboard/logs/my",{headers:{Authorization:"Bearer ".concat(null===(e=document.cookie.match(/access_token=([^;]+)/))||void 0===e?void 0:e[1])}});if(s.ok){let e=await s.json();o(e)}}catch(e){console.error("Failed to load login logs:",e)}},updateProfile=async()=>{x(!0);try{var e;let s=await fetch("/api/v1/users/me",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null===(e=document.cookie.match(/access_token=([^;]+)/))||void 0===e?void 0:e[1])},body:JSON.stringify(p)});if(s.ok)alert("资料更新成功！"),loadProfile();else{let e=await s.json();alert(e.detail||"更新失败")}}catch(e){console.error("Failed to update profile:",e),alert("更新失败，请重试")}finally{x(!1)}},changePassword=async()=>{if(h.new_password!==h.confirm_password){alert("新密码与确认密码不一致");return}if(h.new_password.length<8){alert("新密码至少需要8个字符");return}x(!0);try{var e;let s=await fetch("/api/v1/dashboard/profile/password",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(null===(e=document.cookie.match(/access_token=([^;]+)/))||void 0===e?void 0:e[1])},body:JSON.stringify({current_password:h.current_password,new_password:h.new_password})});if(s.ok)alert("密码修改成功！"),b({current_password:"",new_password:"",confirm_password:""});else{let e=await s.json();alert(e.detail||"密码修改失败")}}catch(e){console.error("Failed to change password:",e),alert("密码修改失败，请重试")}finally{x(!1)}};return d?(0,r.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"加载中..."})]})}):s?(0,r.jsxs)("div",{className:"min-h-full bg-gray-50",children:[(0,r.jsx)("div",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["欢迎，",s.full_name||s.username]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[s.is_admin&&(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 mr-2",children:"管理员"}),"上次登录: ",l[0]?new Date(l[0].login_time).toLocaleString():"暂无记录"]})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[s.is_admin&&(0,r.jsx)("button",{onClick:()=>e.push("/admin/dashboard"),className:"btn-secondary",children:"管理后台"}),(0,r.jsx)("button",{onClick:()=>{document.cookie="access_token=; Max-Age=0; path=/",e.push("/login")},className:"btn-primary",children:"退出登录"})]})]})})}),(0,r.jsx)("div",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"px-4 py-6 sm:px-0",children:[(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsxs)("nav",{className:"-mb-px flex space-x-8",children:[(0,r.jsx)("button",{onClick:()=>c("profile"),className:"".concat("profile"===i?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"个人资料"}),(0,r.jsx)("button",{onClick:()=>c("password"),className:"".concat("password"===i?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"修改密码"}),(0,r.jsx)("button",{onClick:()=>c("logs"),className:"".concat("logs"===i?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"," whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm"),children:"登录记录"})]})}),(0,r.jsxs)("div",{className:"mt-6",children:["profile"===i&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"个人资料"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"全名"}),(0,r.jsx)("input",{type:"text",value:p.full_name,onChange:e=>f({...p,full_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"昵称"}),(0,r.jsx)("input",{type:"text",value:p.nickname,onChange:e=>f({...p,nickname:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"名字"}),(0,r.jsx)("input",{type:"text",value:p.given_name,onChange:e=>f({...p,given_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"姓氏"}),(0,r.jsx)("input",{type:"text",value:p.family_name,onChange:e=>f({...p,family_name:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"手机号码"}),(0,r.jsx)("input",{type:"tel",value:p.phone_number,onChange:e=>f({...p,phone_number:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"性别"}),(0,r.jsxs)("select",{value:p.gender,onChange:e=>f({...p,gender:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,r.jsx)("option",{value:"",children:"请选择"}),(0,r.jsx)("option",{value:"male",children:"男"}),(0,r.jsx)("option",{value:"female",children:"女"}),(0,r.jsx)("option",{value:"other",children:"其他"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"生日"}),(0,r.jsx)("input",{type:"date",value:p.birthdate,onChange:e=>f({...p,birthdate:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"网站"}),(0,r.jsx)("input",{type:"url",value:p.website,onChange:e=>f({...p,website:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"头像URL"}),(0,r.jsx)("input",{type:"url",value:p.picture,onChange:e=>f({...p,picture:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"个人简介"}),(0,r.jsx)("textarea",{rows:3,value:p.profile,onChange:e=>f({...p,profile:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)("button",{onClick:updateProfile,disabled:m,className:"btn-primary disabled:opacity-50",children:m?"保存中...":"保存更改"})})]}),"password"===i&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"修改密码"}),(0,r.jsxs)("div",{className:"max-w-md space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"当前密码"}),(0,r.jsx)("input",{type:"password",value:h.current_password,onChange:e=>b({...h,current_password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"新密码"}),(0,r.jsx)("input",{type:"password",value:h.new_password,onChange:e=>b({...h,new_password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"确认新密码"}),(0,r.jsx)("input",{type:"password",value:h.confirm_password,onChange:e=>b({...h,confirm_password:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,r.jsx)("button",{onClick:changePassword,disabled:m||!h.current_password||!h.new_password||!h.confirm_password,className:"btn-primary disabled:opacity-50",children:m?"修改中...":"修改密码"})]})]}),"logs"===i&&(0,r.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"登录记录"}),0===l.length?(0,r.jsx)("p",{className:"text-gray-500 text-center py-4",children:"暂无登录记录"}):(0,r.jsx)("div",{className:"space-y-4",children:l.map(e=>(0,r.jsx)("div",{className:"border rounded-lg p-4",children:(0,r.jsx)("div",{className:"flex justify-between items-start",children:(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(e.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:e.success?"成功":"失败"}),(0,r.jsx)("span",{className:"text-sm text-gray-600",children:e.login_method}),e.client_name&&(0,r.jsxs)("span",{className:"text-xs text-gray-500",children:["通过 ",e.client_name]})]}),(0,r.jsx)("div",{className:"text-sm text-gray-900",children:new Date(e.login_time).toLocaleString()}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["IP: ",e.ip_address]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.user_agent})]})})},e.id))})]})]})]})})]}):(0,r.jsx)("div",{className:"min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"加载失败"}),(0,r.jsx)("button",{onClick:()=>e.push("/login"),className:"mt-4 btn-primary",children:"重新登录"})]})})}},622:function(e,s,a){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=a(2265),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),l=Object.prototype.hasOwnProperty,o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function q(e,s,a){var r,n={},c=null,d=null;for(r in void 0!==a&&(c=""+a),void 0!==s.key&&(c=""+s.key),void 0!==s.ref&&(d=s.ref),s)l.call(s,r)&&!i.hasOwnProperty(r)&&(n[r]=s[r]);if(e&&e.defaultProps)for(r in s=e.defaultProps)void 0===n[r]&&(n[r]=s[r]);return{$$typeof:t,type:e,key:c,ref:d,props:n,_owner:o.current}}s.Fragment=n,s.jsx=q,s.jsxs=q},7437:function(e,s,a){"use strict";e.exports=a(622)},4033:function(e,s,a){e.exports=a(94)}},function(e){e.O(0,[971,472,744],function(){return e(e.s=9539)}),_N_E=e.O()}]);